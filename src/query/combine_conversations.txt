CREATE OR REPLACE VIEW `combine_conversations` AS SELECT
    `c`.`id` AS `conversation_id`,
    `c`.`is_group_conversation` AS `is_group_conversation`,
    `c`.`order_by` AS `conversation_order_by`,
    (
    SELECT
        COUNT(`uc_o`.`is_read`)
    FROM
        `messages` `uc_o`
    WHERE
        (
            (`uc_o`.`conversation_id` = `c`.`id`) AND(`uc_o`.`is_read` < 1)
        )
) AS `unread_count`,
`sender`.`id` AS `sender_id`,
`sender`.`session_id` AS `sender_session_id`,
`sender`.`name` AS `sender_name`,
`sender`.`is_online` AS `sender_is_online`,
`sender`.`is_chat_screen` AS `sender_is_chat_screen`,
(
    SELECT
        IF(`bu_sender`.`id`, '1', '0')
    FROM
        `blocked_users` `bu_sender`
    WHERE
        (
            (
                `bu_sender`.`user_id` = `receiver`.`id`
            ) AND(
                `bu_sender`.`blocked_user_id` = `sender`.`id`
            )
        )
) AS `sender_is_blocked`,
(
    SELECT
        IF(
            `bu_sb`.`user_id`,
            `bu_sb`.`user_id`,
            '-'
        )
    FROM
        `blocked_users` `bu_sb`
    WHERE
        (
            (`bu_sb`.`user_id` = `receiver`.`id`) AND(
                `bu_sb`.`blocked_user_id` = `sender`.`id`
            )
        )
) AS `sender_blocked_by`,
`sender`.`profile_image` AS `sender_profile_image`,
`receiver`.`id` AS `receiver_id`,
`receiver`.`session_id` AS `receiver_session_id`,
'' AS `group_id`,
`receiver`.`name` AS `receiver_name`,
'' AS `group_name`,
'' AS `group_status`,
`receiver`.`is_online` AS `receiver_is_online`,
`receiver`.`is_chat_screen` AS `receiver_is_chat_screen`,
'' AS `group_is_chat_screen`,
(
    SELECT
        IF(`bu_receiver`.`id`, '1', '0')
    FROM
        `blocked_users` `bu_receiver`
    WHERE
        (
            (
                `bu_receiver`.`user_id` = `sender`.`id`
            ) AND(
                `bu_receiver`.`blocked_user_id` = `receiver`.`id`
            )
        )
) AS `receiver_is_blocked`,
(
    SELECT
        IF(
            `bu_rb`.`user_id`,
            `bu_rb`.`user_id`,
            '-'
        )
    FROM
        `blocked_users` `bu_rb`
    WHERE
        (
            (`bu_rb`.`user_id` = `sender`.`id`) AND(
                `bu_rb`.`blocked_user_id` = `receiver`.`id`
            )
        )
) AS `receiver_blocked_by`,
`receiver`.`profile_image` AS `receiver_profile_image`,
'' AS `group_profile_image`,
'' AS `total_members_in_group`
FROM
    (
        (
            `conversations` `c`
        INNER JOIN `users` `sender` ON
            ((`sender`.`id` = `c`.`from_user_id`))
        )
    INNER JOIN `users` `receiver` ON
        ((`receiver`.`id` = `c`.`to_user_id`))
    )
WHERE
    (`c`.`is_group_conversation` = '0')
UNION ALL
SELECT
    `c`.`id` AS `conversation_id`,
    `c`.`is_group_conversation` AS `is_group_conversation`,
    `c`.`order_by` AS `conversation_order_by`,
    (
    SELECT
        COUNT(`uc_g`.`is_read`)
    FROM
        `messages` `uc_g`
    WHERE
        (
            (`uc_g`.`conversation_id` = `c`.`id`) AND(`uc_g`.`is_read` < 1)
        )
) AS `unread_count`,
`GM`.`user_id` AS `sender_id`,
`sender`.`session_id` AS `sender_session_id`,
`receiver`.`name` AS `sender_name`,
`sender`.`is_online` AS `sender_is_online`,
`sender`.`is_chat_screen` AS `sender_is_chat_screen`,
'' AS `sender_is_blocked`,
'' AS `sender_blocked_by`,
`sender`.`profile_image` AS `sender_profile_image`,
`receiver`.`id` AS `receiver_id`,
'' AS `receiver_session_id`,
`receiver`.`id` AS `group_id`,
`receiver`.`name` AS `receiver_name`,
`receiver`.`name` AS `group_name`,
`receiver`.`status` AS `group_status`,
'' AS `receiver_is_online`,
'' AS `receiver_is_chat_screen`,
`receiver`.`is_chat_screen` AS `group_is_chat_screen`,
'' AS `receiver_is_blocked`,
'' AS `receiver_blocked_by`,
`receiver`.`group_profile_image` AS `receiver_profile_image`,
`receiver`.`group_profile_image` AS `group_profile_image`,
`receiver`.`total_members` AS `total_members_in_group`
FROM
    (
        (
            `conversations` `c`
        INNER JOIN `users` `sender` ON
            ((`sender`.`id` = `c`.`from_user_id`))
        )
    INNER JOIN(
            `groups` `receiver`
        INNER JOIN `group_members` `GM` ON
            ((`receiver`.`id` = `GM`.`group_id`))
        )
    ON
        ((`receiver`.`id` = `c`.`to_user_id`))
    )
WHERE
    (`c`.`is_group_conversation` = '1');